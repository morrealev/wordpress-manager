# JavaScript Internationalization

Use this file when internationalizing JavaScript code in WordPress blocks, plugins, and themes.

## @wordpress/i18n package

### Installation

```bash
npm install @wordpress/i18n
```

### Core functions

```js
import { __, _x, _n, _nx, sprintf } from '@wordpress/i18n';

// Simple translation
const label = __('Save', 'my-text-domain');

// With context
const post = _x('Post', 'verb', 'my-text-domain');

// Plurals
const message = sprintf(
    _n('%d item', '%d items', count, 'my-text-domain'),
    count
);

// Plurals with context
const posts = sprintf(
    _nx('%d post', '%d posts', count, 'blog posts', 'my-text-domain'),
    count
);
```

### sprintf for variable substitution

```js
import { __, sprintf } from '@wordpress/i18n';

// Positional placeholders
const text = sprintf(
    /* translators: 1: product name, 2: price */
    __('%1$s costs %2$s', 'my-text-domain'),
    productName,
    price
);

// %s placeholder
const greeting = sprintf(
    /* translators: %s: user name */
    __('Hello, %s!', 'my-text-domain'),
    userName
);
```

## Block editor (Gutenberg) usage

### Block registration

```js
import { registerBlockType } from '@wordpress/blocks';
import { __ } from '@wordpress/i18n';

registerBlockType('my-plugin/my-block', {
    title: __('My Block', 'my-text-domain'),
    description: __('A custom block.', 'my-text-domain'),
    keywords: [
        __('example', 'my-text-domain'),
        __('custom', 'my-text-domain'),
    ],
    // ...
});
```

### InspectorControls

```js
import { InspectorControls } from '@wordpress/block-editor';
import { PanelBody, ToggleControl } from '@wordpress/components';
import { __ } from '@wordpress/i18n';

<InspectorControls>
    <PanelBody title={__('Settings', 'my-text-domain')}>
        <ToggleControl
            label={__('Show title', 'my-text-domain')}
            help={__('Toggle the title visibility.', 'my-text-domain')}
            checked={showTitle}
            onChange={(val) => setAttributes({ showTitle: val })}
        />
    </PanelBody>
</InspectorControls>
```

## Translation file loading

### For blocks (block.json method — recommended)

```json
{
    "name": "my-plugin/my-block",
    "title": "My Block",
    "textdomain": "my-text-domain"
}
```

WordPress automatically loads translation files for blocks with `textdomain` in `block.json`.

### For non-block scripts

Register script translations in PHP:

```php
add_action('init', function() {
    wp_set_script_translations(
        'my-script-handle',    // Same handle used in wp_register_script
        'my-text-domain',
        plugin_dir_path(__FILE__) . 'languages'
    );
});
```

### Translation file format

JS translations use JSON (JED format). Generated by WP-CLI:

```bash
wp i18n make-json languages/ --no-purge
```

Output files: `my-text-domain-{locale}-{md5hash}.json`

## block.json translatable fields

These fields are automatically translated when `textdomain` is set:

```json
{
    "title": "My Block",
    "description": "Block description here.",
    "keywords": ["example", "demo"],
    "styles": [
        { "name": "default", "label": "Default" },
        { "name": "fancy", "label": "Fancy" }
    ],
    "variations": [
        {
            "name": "wide",
            "title": "Wide",
            "description": "Wide layout variation."
        }
    ],
    "textdomain": "my-text-domain"
}
```

## Common mistakes

### Do NOT use template literals for translation keys

```js
// WRONG — extraction tools cannot parse
const text = __(`Hello ${name}`, 'my-text-domain');

// CORRECT
const text = sprintf(__('Hello %s', 'my-text-domain'), name);
```

### Do NOT use dynamic text domains

```js
// WRONG
const text = __(message, domain);

// CORRECT — literal string only
const text = __('Hello', 'my-text-domain');
```

### Do NOT concatenate inside translation calls

```js
// WRONG
const text = __('Total: ' + count + ' items', 'my-text-domain');

// CORRECT
const text = sprintf(__('Total: %d items', 'my-text-domain'), count);
```

## Verification

```bash
# Generate POT from JS files
wp i18n make-pot . languages/my-text-domain.pot --include="src/**/*.js,src/**/*.jsx"

# Generate JSON translation files
wp i18n make-json languages/ --no-purge

# Check for untranslated strings in JS
grep -rn "['\"]\`" --include="*.js" --include="*.jsx" src/ | grep -v "__\|_x\|_n\|sprintf"
```
